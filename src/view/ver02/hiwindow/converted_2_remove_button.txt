hiWindow.document.writeln("<!DOCTYPE html>");
hiWindow.document.writeln("<html lang=\"en\">");
hiWindow.document.writeln("<head>");
hiWindow.document.writeln("    <meta charset=\"UTF-8\">");
hiWindow.document.writeln("    <title>Insert Hours</title>");
hiWindow.document.writeln("    <style>");
hiWindow.document.writeln("        body {");
hiWindow.document.writeln("            background: linear-gradient(0.25turn, #e5e5e5, #b6b6b6, #e5e5e5);");
hiWindow.document.writeln("        }");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        label {");
hiWindow.document.writeln("            color: #939393;");
hiWindow.document.writeln("        }");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        input {");
hiWindow.document.writeln("            background: #e8ffe5;");
hiWindow.document.writeln("            font-size: 16px;");
hiWindow.document.writeln("            border-radius: 15px;");
hiWindow.document.writeln("            border-width: 0px;");
hiWindow.document.writeln("            padding: 5px;");
hiWindow.document.writeln("            padding-left: 20px;");
hiWindow.document.writeln("            margin: 5px;");
hiWindow.document.writeln("            width: 600px;");
hiWindow.document.writeln("            height: 32px;");
hiWindow.document.writeln("        }");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        input#hoursAmount {");
hiWindow.document.writeln("            width: 50px;");
hiWindow.document.writeln("        }");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        select {");
hiWindow.document.writeln("            background: #e8ffe5;");
hiWindow.document.writeln("            font-size: 16px;");
hiWindow.document.writeln("            border-radius: 15px;");
hiWindow.document.writeln("            border-width: 0px;");
hiWindow.document.writeln("            padding: 5px;");
hiWindow.document.writeln("            padding-left: 20px;");
hiWindow.document.writeln("            margin: 5px;");
hiWindow.document.writeln("            width: 620px;");
hiWindow.document.writeln("            height: 40px;");
hiWindow.document.writeln("        }");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        input#insertButton {");
hiWindow.document.writeln("            background: #9cff62;");
hiWindow.document.writeln("            box-shadow: 3px 3px 0 #000000;");
hiWindow.document.writeln("            width: 150px;");
hiWindow.document.writeln("            height: 40px;");
hiWindow.document.writeln("            border-width: 3px;");
hiWindow.document.writeln("            padding-left: 0px;");
hiWindow.document.writeln("            margin-left: 50px;");
hiWindow.document.writeln("        }");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        input#removeButton {");
hiWindow.document.writeln("            background: #ff6262;");
hiWindow.document.writeln("            box-shadow: 3px 3px 0 #000000;");
hiWindow.document.writeln("            transition: all .15s linear 0s;");
hiWindow.document.writeln("            position: relative;");
hiWindow.document.writeln("            display: inline-block;");
hiWindow.document.writeln("            width: 150px;");
hiWindow.document.writeln("            height: 40px;");
hiWindow.document.writeln("            border-width: 3px;");
hiWindow.document.writeln("            padding-left: 0px;");
hiWindow.document.writeln("            margin-left: 20px;");
hiWindow.document.writeln("        }");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        input#insertButton:active {");
hiWindow.document.writeln("            background: #63a83b;");
hiWindow.document.writeln("            box-shadow: 0px 0px 0 #000000;");
hiWindow.document.writeln("            transition: all .05s linear 0s;");
hiWindow.document.writeln("            top: 3px;");
hiWindow.document.writeln("            left: 3px;");
hiWindow.document.writeln("            position: relative;");
hiWindow.document.writeln("         }");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        input#insertButton:hover {");
hiWindow.document.writeln("            border-color: #0014ff;");
hiWindow.document.writeln("        }");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        input#removeButton:active {");
hiWindow.document.writeln("            background: #ad3f3f;");
hiWindow.document.writeln("            box-shadow: 0px 0px 0 #000000;");
hiWindow.document.writeln("            transition: all .05s linear 0s;");
hiWindow.document.writeln("            top: 3px;");
hiWindow.document.writeln("            left: 3px;");
hiWindow.document.writeln("            position: relative;");
hiWindow.document.writeln("         }");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        input#removeButton:hover {");
hiWindow.document.writeln("            border-color: #0014ff;");
hiWindow.document.writeln("        }");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        div#status {");
hiWindow.document.writeln("            font-size: 16px;");
hiWindow.document.writeln("            color: #939393;");
hiWindow.document.writeln("            margin-top: 10px;");
hiWindow.document.writeln("            font-weight: bold;");
hiWindow.document.writeln("        }");
hiWindow.document.writeln("        b {");
hiWindow.document.writeln("            font-weight: normal;");
hiWindow.document.writeln("        }");
hiWindow.document.writeln("    </style>");
hiWindow.document.writeln("</head>");
hiWindow.document.writeln("<body>");
hiWindow.document.writeln("<form>");
hiWindow.document.writeln("    <label for=\"filterTasks\">Filter: </label>");
hiWindow.document.writeln("    <input type=\"text\" id=\"filterTasks\" value=\"\" onkeyup=\"findTasksFilterAndSetToMenu()\">");
hiWindow.document.writeln("    <br>");
hiWindow.document.writeln("    <label for=\"foundTasks\">Task: </label>");
hiWindow.document.writeln("    <select id=\"foundTasks\">");
hiWindow.document.writeln("    </select>");
hiWindow.document.writeln("    <br><label for=\"hoursAmount\">Hours:</label>");
hiWindow.document.writeln("    <input type=\"text\" id=\"hoursAmount\" value=\"40\" size=\"100px\">");
hiWindow.document.writeln("    <input type=\"button\" id=\"insertButton\" value=\"INSERT\" onclick=\"insertHours()\">");
hiWindow.document.writeln("    <input type=\"button\" id=\"removeButton\" value=\"REMOVE\" onclick=\"removeHours()\">");
hiWindow.document.writeln("    <br>");
hiWindow.document.writeln("    <div id=\"status\">Status: <b id=\"statusMessage\">waiting for pressing INSERT button</b></div>");
hiWindow.document.writeln("</form>");
hiWindow.document.writeln("<script>");
hiWindow.document.writeln("    let foundFiltered = [];");
hiWindow.document.writeln("    let foundId = new Map();");
hiWindow.document.writeln("    let task = \"\";");
hiWindow.document.writeln("    let hours = \"\";");
hiWindow.document.writeln("    const status = document.querySelector('#statusMessage');");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("    function findTasksFilterAndSetToMenu() {");
hiWindow.document.writeln("        console.log(\"filter\");");
hiWindow.document.writeln("        //clear task list");
hiWindow.document.writeln("        const foundTasks = document.querySelector('#foundTasks');");
hiWindow.document.writeln("        while (foundTasks.firstChild) {");
hiWindow.document.writeln("            foundTasks.removeChild(foundTasks.lastChild);");
hiWindow.document.writeln("        }");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        //find tasks");
hiWindow.document.writeln("        let found = [];");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        var taskTable = window.opener.document.querySelector('#table3'); //put here window.opener.  <<<<<<");
hiWindow.document.writeln("        var tasksRows = taskTable.children[1];");
hiWindow.document.writeln("        for(let i = 1; i < tasksRows.children.length; i++) {");
hiWindow.document.writeln("            let taskCell = tasksRows.children[i];");
hiWindow.document.writeln("            found.push(i + \")\" + taskCell.children[1].textContent);");
hiWindow.document.writeln("            foundId.set(found[i-1], i);");
hiWindow.document.writeln("            console.log(found[i-1] + \"id = \" + i);");
hiWindow.document.writeln("        };");
hiWindow.document.writeln("        console.log(foundId);");
hiWindow.document.writeln("        console.log(foundId.get(found[4]));");
hiWindow.document.writeln("        //find tasks");
hiWindow.document.writeln(" ");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        //filter");
hiWindow.document.writeln("        let filter = document.querySelector('#filterTasks').value;");
hiWindow.document.writeln("        filter = filter.toLowerCase();");
hiWindow.document.writeln("        let words = filter.split(\" \");");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        foundFiltered = [];");
hiWindow.document.writeln("        found.forEach(task => {");
hiWindow.document.writeln("            let taskLowerCase = task.toLowerCase();");
hiWindow.document.writeln("            let taskShallBeAdded = true;");
hiWindow.document.writeln("            words.forEach(word => {");
hiWindow.document.writeln("                if (taskLowerCase.search(word) === -1 && word !== \"\") {");
hiWindow.document.writeln("                    taskShallBeAdded = false;");
hiWindow.document.writeln("                }");
hiWindow.document.writeln("            });");
hiWindow.document.writeln("            if (taskShallBeAdded) {");
hiWindow.document.writeln("                foundFiltered.push(task);");
hiWindow.document.writeln("            }");
hiWindow.document.writeln("        });");
hiWindow.document.writeln(" ");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        let i = 0;");
hiWindow.document.writeln("        foundFiltered.forEach(found => {");
hiWindow.document.writeln("            let newOption = new Option(found);");
hiWindow.document.writeln("            i++;");
hiWindow.document.writeln("            let id = \"foundTask-\" + i;");
hiWindow.document.writeln("            newOption.setAttribute('value', found);");
hiWindow.document.writeln("            newOption.setAttribute('id', id);");
hiWindow.document.writeln("            foundTasks.add(newOption);");
hiWindow.document.writeln("        })");
hiWindow.document.writeln("    }");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("    function insertHours() {");
hiWindow.document.writeln("        task = document.querySelector('#foundTasks').value;");
hiWindow.document.writeln("        hours = document.querySelector('#hoursAmount').value;");
hiWindow.document.writeln("        let taskId = foundId.get(task);");
hiWindow.document.writeln("        status.textContent = hours + \" hours were inserted to \" + task;");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        //insert hours");
hiWindow.document.writeln("        // ! be careful with these");
hiWindow.document.writeln("        let bgColorDefaultExpected = \"white\";");
hiWindow.document.writeln("        let bgColorPartialHoursExpected = \"rgb(205, 226, 183)\";");
hiWindow.document.writeln("        let maxHoursDaily = 8;");
hiWindow.document.writeln("        // ! be careful with these");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        let shallInsertHours = false;");
hiWindow.document.writeln("        let totalDayHours = 0;");
hiWindow.document.writeln("        var totalDayHoursTable = window.opener.document.querySelector('#table7');  //put here window.opener.  <<<<<<");
hiWindow.document.writeln("        var dayHoursTable = window.opener.document.querySelector('#table4');  //put here window.opener.  <<<<<<");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        var totalDayHoursRows = totalDayHoursTable.children[1];");
hiWindow.document.writeln("        var totalDayHoursCells = totalDayHoursRows.children[1];");
hiWindow.document.writeln("        for(let i = 0; i < totalDayHoursCells.children.length; i++) {");
hiWindow.document.writeln("            let dayHoursComponent = totalDayHoursCells.children[i];");
hiWindow.document.writeln("            let dayHoursBackgroundColor = dayHoursComponent.style.getPropertyValue(\"background-color\");");
hiWindow.document.writeln("            shallInsertHours = (dayHoursBackgroundColor === bgColorPartialHoursExpected || dayHoursBackgroundColor === bgColorDefaultExpected);");
hiWindow.document.writeln("            if(shallInsertHours) {");
hiWindow.document.writeln("                let totalDayHoursText = dayHoursComponent.textContent;");
hiWindow.document.writeln("                totalDayHours = parseFloat(totalDayHoursText);");
hiWindow.document.writeln("                console.log(\"Day \" + i + \" -> \" + totalDayHours);");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("                if(totalDayHours < maxHoursDaily && hours > parseFloat(0)) {");
hiWindow.document.writeln("                    let freeHours = maxHoursDaily - totalDayHours;");
hiWindow.document.writeln("                    let hoursToInsert = freeHours <= hours ? freeHours : hours;");
hiWindow.document.writeln("                    console.log(\"YES, insert hours here: \" + hoursToInsert + \" from \" + hours + \"| i = \" + i + \",taskId=\" + taskId);");
hiWindow.document.writeln("                    hours = hours - hoursToInsert;");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("                    //var dayHoursTable = document.querySelector('#table4');");
hiWindow.document.writeln("                    let dayHoursTBody = dayHoursTable.children[1];");
hiWindow.document.writeln("                    let dayHoursRow = dayHoursTBody.children[taskId];  //taskId=3");
hiWindow.document.writeln("                    let dayHoursCell = dayHoursRow.children[i]; //i=0");
hiWindow.document.writeln("                    let dayHoursInput = dayHoursCell.children[0];");
hiWindow.document.writeln("                    let currentHours = parseFloat(dayHoursInput.value);");
hiWindow.document.writeln("                    dayHoursInput.value = currentHours + parseFloat(hoursToInsert);");
hiWindow.document.writeln("                    dayHoursInput.onchange();");
hiWindow.document.writeln("                    // validateAllFields();");
hiWindow.document.writeln("                    window.opener.document.querySelectorAll('input[id=validateAllFieldsButton]')[0].click();");
hiWindow.document.writeln("                }");
hiWindow.document.writeln("            }");
hiWindow.document.writeln("        };");
hiWindow.document.writeln("    }");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("    function removeHours() {");
hiWindow.document.writeln("        task = document.querySelector('#foundTasks').value;");
hiWindow.document.writeln("        hours = document.querySelector('#hoursAmount').value;");
hiWindow.document.writeln("        let taskId = foundId.get(task);");
hiWindow.document.writeln("        status.textContent = hours + \" hours were removed from \" + task;");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        //insert hours");
hiWindow.document.writeln("        // ! be careful with these");
hiWindow.document.writeln("        let maxHoursDaily = 8;");
hiWindow.document.writeln("        // ! be careful with these");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        let shallRemoveHours = false;");
hiWindow.document.writeln("        let totalDayHours = 0;");
hiWindow.document.writeln("        var totalDayHoursTable = window.opener.document.querySelector('#table7');  //put here window.opener.  <<<<<<");
hiWindow.document.writeln("        var dayHoursTable = window.opener.document.querySelector('#table4');  //put here window.opener.  <<<<<<");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("        var totalDayHoursRows = totalDayHoursTable.children[1];");
hiWindow.document.writeln("        var totalDayHoursCells = totalDayHoursRows.children[1];");
hiWindow.document.writeln("        for(let i = totalDayHoursCells.children.length - 1; i >= 0; i--) {");
hiWindow.document.writeln("            let dayHoursComponent = totalDayHoursCells.children[i];");
hiWindow.document.writeln("            let totalDayHoursText = dayHoursComponent.textContent;");
hiWindow.document.writeln("            totalDayHours = parseFloat(totalDayHoursText);");
hiWindow.document.writeln("            console.log(\"Day \" + i + \" -> \" + totalDayHours);");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("            //var dayHoursTable = document.querySelector('#table4');");
hiWindow.document.writeln("            let dayHoursTBody = dayHoursTable.children[1];");
hiWindow.document.writeln("            let dayHoursRow = dayHoursTBody.children[taskId];  //taskId=5");
hiWindow.document.writeln("            let dayHoursCell = dayHoursRow.children[i]; //i=0");
hiWindow.document.writeln("            let dayHoursInput = dayHoursCell.children[0];");
hiWindow.document.writeln("            let currentHours = parseFloat(dayHoursInput.value);");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("            shallRemoveHours = totalDayHours > parseFloat(0) && hours !== parseFloat(0) && currentHours > parseFloat(0);");
hiWindow.document.writeln("            if(shallRemoveHours) {");
hiWindow.document.writeln("                let hoursToRemove = totalDayHours <= hours ? totalDayHours : hours;");
hiWindow.document.writeln("                console.log(\"YES, remove hours here: \" + hoursToRemove + \" from \" + hours + \"| i = \" + i + \",taskId=\" + taskId);");
hiWindow.document.writeln("                hours = hours - hoursToRemove;");
hiWindow.document.writeln(" ");
hiWindow.document.writeln("                dayHoursInput.value = currentHours - hoursToRemove;");
hiWindow.document.writeln("                try {");
hiWindow.document.writeln("                    dayHoursInput.onchange();");
hiWindow.document.writeln("                } catch (error) {");
hiWindow.document.writeln("                    console.log(\"Upps: some strange error :-(\");");
hiWindow.document.writeln("                }");
hiWindow.document.writeln("                //validateAllFields();");
hiWindow.document.writeln("                window.opener.document.querySelectorAll('input[id=validateAllFieldsButton]')[0].click();");
hiWindow.document.writeln("                window.opener.document.document.querySelectorAll('input[id=clearZerosButton]')[0].click();");
hiWindow.document.writeln("            }");
hiWindow.document.writeln("        };");
hiWindow.document.writeln("    }");
hiWindow.document.writeln("</script>");
hiWindow.document.writeln("</body>");
hiWindow.document.writeln("</html>");
